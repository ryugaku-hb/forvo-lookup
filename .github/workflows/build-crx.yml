# GitHub Actions å·¥ä½œæµåç§°ï¼Œä¼šæ˜¾ç¤ºåœ¨ Actions é¡µé¢ä¸Š
name: Release Extension ZIP # name: å·¥ä½œæµåç§°ï¼Œæ˜¾ç¤ºåœ¨ GitHub Actions é¡µé¢

# å·¥ä½œæµçš„è§¦å‘æ¡ä»¶ï¼šå½“ä»£ç è¢« push ä¸”å¸¦æœ‰ Git æ ‡ç­¾ï¼ˆå¦‚ v1.0.0ï¼‰æ—¶è§¦å‘
on: # on æŒ‡å®šè§¦å‘ workflow çš„äº‹ä»¶ï¼ˆå¦‚ push, pull_request, workflow_dispatchï¼‰
  push: # push: è¡¨ç¤ºâ€œå½“æœ‰äºº push ä»£ç åˆ° GitHubâ€æ—¶è§¦å‘
    tags: # tags: è¿›ä¸€æ­¥é™å®šä¸ºâ€œåªæœ‰ push æ ‡ç­¾â€æ‰è§¦å‘
      - "v*" # åªåŒ¹é…ä»¥ "v" å¼€å¤´çš„æ ‡ç­¾ï¼Œæ¯”å¦‚ v1.0ã€v2.3.4

jobs: # jobs: åŒ…å«æ‰€æœ‰ä»»åŠ¡ï¼ˆjobï¼‰å®šä¹‰ï¼Œæ¯ä¸ª job åŒ…æ‹¬æ‰§è¡Œå™¨ä¸æ­¥éª¤
  release: # ä»»åŠ¡å”¯ä¸€æ ‡è¯†ï¼Œå¦‚ build æˆ– testï¼Œå¯è‡ªå®šä¹‰
    # GitHub æä¾›çš„äº‘ç«¯ Linux ç¯å¢ƒï¼Œé»˜è®¤æœ€æ–° Ubuntu
    runs-on: ubuntu-latest # runs-on: æŒ‡å®šè¿è¡Œç¯å¢ƒï¼ˆå¦‚ ubuntu-latestï¼‰

    steps: # steps: å®šä¹‰æ‰§è¡Œæ­¥éª¤åˆ—è¡¨ï¼ˆæ¯ä¸ªæ˜¯ä¸€ä¸ª stepï¼‰
      - name: Checkout code Â· æ‹‰å–ä»“åº“ä»£ç  # name: æ­¥éª¤åç§°ï¼ˆå»ºè®®å¡«å†™ï¼Œä¾¿äºæ—¥å¿—æŸ¥çœ‹ï¼‰
        # æ‹‰å–å½“å‰ä»“åº“çš„ä»£ç ï¼Œå¿…é¡»çš„ç¬¬ä¸€æ­¥
        # https://github.com/actions/checkout
        # About: Action for checking out a repo
        uses: actions/checkout@v4 # uses: ä¸ run äºŒé€‰ä¸€ï¼Œä½¿ç”¨ä¸€ä¸ªç°æˆçš„ GitHub Action

      - name: Install zip Â· å®‰è£… zip å·¥å…·
        run: sudo apt-get update && sudo apt-get install -y zip

      - name: Zip extension folder Â· æ‰“åŒ…æ‰©å±•ç›®å½•ä¸º zip æ–‡ä»¶
        run: | # run: ä¸ uses äºŒé€‰ä¸€ï¼Œæ‰§è¡Œ shell å‘½ä»¤
          VERSION=${{ github.ref_name }} 
          ZIP_NAME="forvo-lookup-${VERSION}.zip"
          echo "Creating zip: ${ZIP_NAME} (version: ${VERSION})"
          zip -r "$ZIP_NAME" . -x ".github/*" ".git/*" ".gitignore" "*.zip"  "*.md" "LICENSE"

      - name: Upload ZIP to GitHub Release Â· ä¸Šä¼  zip åˆ° GitHub Release é¡µé¢
        # https://github.com/softprops/action-gh-release
        # ğŸ“¦ GitHub Action for creating GitHub Releases
        uses: softprops/action-gh-release@v2
        with: # with: ç»™ uses çš„ Action ä¼ å‚
          # å‚æ•° tag_name: String
          # Name of a tag. defaults to github.ref_name
          tag_name: ${{ github.ref_name }}
          # å‚æ•° files: String
          # Newline-delimited globs of paths to assets to upload for release
          files: forvo-lookup-${{ github.ref_name }}.zip
        env: # env: è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¦‚è®¿é—®æƒé™
          # GITHUB_TOKEN: GitHub è‡ªåŠ¨æä¾›çš„ä»¤ç‰Œï¼Œå…·æœ‰å‘å¸ƒæƒé™
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

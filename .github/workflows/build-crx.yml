# GitHub Actions 工作流名称，会显示在 Actions 页面上
name: Release Extension ZIP # name: 工作流名称，显示在 GitHub Actions 页面

# 工作流的触发条件：当代码被 push 且带有 Git 标签（如 v1.0.0）时触发
on: # on 指定触发 workflow 的事件（如 push, pull_request, workflow_dispatch）
  push: # push: 表示“当有人 push 代码到 GitHub”时触发
    tags: # tags: 进一步限定为“只有 push 标签”才触发
      - "v*" # 只匹配以 "v" 开头的标签，比如 v1.0、v2.3.4

jobs: # jobs: 包含所有任务（job）定义，每个 job 包括执行器与步骤
  release: # 任务唯一标识，如 build 或 test，可自定义
    # GitHub 提供的云端 Linux 环境，默认最新 Ubuntu
    runs-on: ubuntu-latest # runs-on: 指定运行环境（如 ubuntu-latest）

    steps: # steps: 定义执行步骤列表（每个是一个 step）
      - name: Checkout code · 拉取仓库代码 # name: 步骤名称（建议填写，便于日志查看）
        # 拉取当前仓库的代码，必须的第一步
        # https://github.com/actions/checkout
        # About: Action for checking out a repo
        uses: actions/checkout@v4 # uses: 与 run 二选一，使用一个现成的 GitHub Action

      - name: Zip extension folder · 打包扩展目录为 zip 文件
        run: | # run: 与 uses 二选一，执行 shell 命令
          VERSION=${{ github.ref_name }} 
          ZIP_NAME="forvo-lookup-${VERSION}.zip"
          echo "Creating zip: $ZIP_NAME (version: $VERSION)"
          zip -r "$ZIP_NAME" . \
            -x ".github/*" \ 
            ".git/*" \
            ".gitignore"\
            "*.zip" \
            "*.md"

      - name: Upload ZIP to GitHub Release · 上传 zip 到 GitHub Release 页面
        # https://github.com/softprops/action-gh-release
        # 📦 GitHub Action for creating GitHub Releases
        uses: softprops/action-gh-release@v2
        with: # with: 给 uses 的 Action 传参
          # 参数 tag_name: String
          # Name of a tag. defaults to github.ref_name
          tag_name: ${{ github.ref_name }}
          # 参数 files: String
          # Newline-delimited globs of paths to assets to upload for release
          files: forvo-lookup-${{ github.ref_name }}.zip
        env: # env: 设置环境变量，如访问权限
          # GITHUB_TOKEN: GitHub 自动提供的令牌，具有发布权限
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
